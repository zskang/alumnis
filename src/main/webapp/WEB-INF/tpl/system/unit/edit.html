<!DOCTYPE html>
<html class="no-js" lang="zh_CN">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
    
    <title>#title</title>
    #required_css
</head>

<body>#loading
	<!-- 风格切换 --> 
    #stylepage
    <div class="app ${layout}"> 
        <!-- 头部菜单 -->
        #header
        <section class="layout">
            <!-- 菜单 -->
            #sidebar
            <!-- 内容主体 -->
            <section class="main-content">
            	<!-- 主体操作栏 -->
            	<header class="header navbar bb">
            		<!-- 左按钮区 -->
                    <div class="btn-group tool-button">
                    	<a class="btn btn-primary navbar-btn" href="$!basePath/system/unit"><i class="ti-angle-left"></i> 返回</a>
                    </div>
                </header>
                <div class="content-wrap">
                   	<div class="wrapper">
                   	<section class="panel pt20 pl20 pr20">
                       	<form id="unitEditForm" role="form" class="form-horizontal parsley-form" data-parsley-validate action="$!basePath/system/unit/edit/do" method="post">
                       		<input type="hidden" name="id" value="$!unit.id" />
                       		<div class="row mb10">
                        		<div class="col-lg-12">
			                     	<div class="form-group has-feedback">
			                             <label for="parentId" class="col-sm-1 control-label">上级机构</label>
			                             <div class="col-sm-10">
			                             	<div class="input-group">
			                             		<input id="parentId" type="text" class="form-control" placeholder="上级机构，不选择默认为顶级机构" disabled value="$!parentUnit"/>
			                             		<span class="input-group-btn">
			                             			<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#dialogSelectParentUnit" #if($!noUnit) disabled="disabled"#end><i class="ti-plus"></i> 选择</button>
			                             		</span>
			                             	</div>
			                             	<input type="hidden" name="parentId" value="$!unit.parentId">
			                             </div>
			                         </div>
			                         <div class="hr-line-dashed"></div>
			                         <div class="form-group">
			                             <label for="name" class="col-sm-1 control-label">名称</label>
			                             <div class="col-sm-10">
			                                 <input type="text" class="form-control" name="name" data-parsley-required="true" placeholder="机构名称" value="$!unit.name">
			                             </div>
			                         </div>
			                         <div class="hr-line-dashed"></div>
			                         <div class="form-group">
			                             <label for="address" class="col-sm-1 control-label">地址</label>
			                             <div class="col-sm-10">
			                                 <input type="text" name="address" class="form-control" placeholder="机构所在地址" value="$!unit.address">
			                                 <p class="help-block no-m">例如：安徽省合肥市高新区长江西路001号</p>
			                             </div>
			                         </div>
			                         <div class="hr-line-dashed"></div>
			                         <div class="form-group">
			                             <label for="contact" class="col-sm-1 control-label">联系人</label>
			                             <div class="col-sm-4">
			                                 <input type="text" name="contact" class="form-control" placeholder="联系人姓名" value="$!unit.contact">
			                             </div>
			                             <label for="mobile" class="col-sm-1 control-label">联系方式</label>
			                             <div class="col-sm-5">
			                                 <input type="text" name="mobile" class="form-control" placeholder="固定电话、手机号码等" value="$!unit.mobile">
			                             </div>
			                         </div>
			                         <div class="hr-line-dashed"></div>
			                         <div class="form-group">
			                             <label for="email" class="col-sm-1 control-label">电子邮件</label>
			                             <div class="col-sm-4">
			                                 <input type="text" name="email" class="form-control" placeholder="格式：xxx@xxx.xx" data-parsley-type="email" data-parsley-trigger="change" value="$!unit.email">
			                             </div>
			                             <label for="web" class="col-sm-1 control-label">网站地址</label>
			                             <div class="col-sm-5">
			                                 <input type="text" name="web" class="form-control" placeholder="http://" value="$!unit.web">
			                             </div>
			                         </div>
			                         <div class="hr-line-dashed"></div>
			                         <div class="form-group">
			                             <label for="enabled" class="col-sm-1 control-label">是否启用</label>
			                             <div class="col-sm-4 switcha">
			                                <div class="mr15">
	                                            <input type="checkbox" name="enabled" class="js-switch-blue" #if($!unit.enabled)checked="checked"#end>
	                                        </div>
			                             </div>
			                             #if($!isSystemUnit == true)
			                             <label for="enabled" class="col-sm-1 control-label">系统机构</label>
			                             <div class="col-sm-4 switcha">
			                                <div class="mr15">
	                                            <input type="checkbox" name="system" class="js-switch-blue" #if($!unit.system)checked="checked"#end>
	                                        </div>
			                             </div>
			                             #end
			                         </div>
                        		</div>
                       		</div>
                      		<div class="col-lg-12">
                      			<div class="form-group text-center">
	                         		<label></label>
                                    <div>
                                        <button class="btn btn-primary btn-block btn-lg btn-parsley" data-loading-text="正在提交...">提   交</button>
                                    </div>
                                </div>
                      		</div>
                       	</form>
                       	</section>
                    </div>
                </div>
                <a class="exit-offscreen"></a>
            </section>
        </section>
    </div>
    <!-- 选择上级机构 -->
    <div id="dialogSelectParentUnit" class="modal fade bs-modal-sm" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title">选择上级机构</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
	                    <div class="col-xs-12">
		                     <div id="jsTreeParentUnit" class="demo"></div>
	                    </div>
                    </div>
                </div>
                <div class="modal-footer">
                	#if($!isSystemUnit == true)
                	<div class="pull-left">
                		<button type="button" class="btn btn-success" data-dismiss="modal" onclick="selectFirstMenu()">设为顶级机构</button>
                	</div>
                	#end
                    <button type="button" class="btn btn-default" data-dismiss="modal">取  消</button>
                    <button type="button" class="btn btn-primary" onclick="selectParentMenu()">确认选择</button>
                </div>
            </div>
        </div>
    </div>
    #required_js

    <!-- 页面组件脚本 -->
    <script src="$!basePath/framework/plugins/count-to/jquery.countTo.js"></script>
    <script src="$!basePath/framework/plugins/switchery/switchery.js"></script>
    
    <!-- 本页面脚本 -->
    <script src="$!basePath/framework/js/form/form.js"></script>
    <script src="$!basePath/framework/js/view/toast.js"></script>
    <script src="$!basePath/framework/js/view/tree.js"></script>
    <script src="$!basePath/framework/js/form/validator.js"></script>
    <script type="text/javascript">
    function initTreeView(){
		$("#jsTreeParentUnit").jstree({
			plugins : [ "wholerow"],
			core : {
				data : {
					url : function(node){
						return node.id === "#" ? "$!basePath/system/unit/tree" : "$!basePath/system/unit/tree/"+node.id
					}
				},
				multiple : false
			}
		}).on("dblclick.jstree", function(node){
			selectParentMenu();
		});
    }
    //选择父菜单
    function selectParentMenu(){
    	var tree = $.jstree.reference("#jsTreeParentUnit");
    	var node = tree.get_selected(true);
    	$("#unitEditForm #parentId").val(node[0].text);
    	$("#unitEditForm input[name='parentId']").val(node[0].id);
    	$("#dialogSelectParentUnit").modal("hide");
    }
    function selectFirstMenu(){
    	$("#unitEditForm #parentId").val("顶级机构");
    	$("#unitEditForm input[name='parentId']").val("-1");
    	$("#dialogSelectParentUnit").modal("hide");
    }
	$(function(){
		$('#unitEditForm').ajaxForm({
			beforeSubmit:function(arr, $form, options){
				$form.find("button:submit").button("loading");
			},
			success : function(data, statusText, xhr, $form) {
				if(data.success == true){
					Toast.success("机构修改成功，3秒后返回组织机构首页", function(){
						//返回上级菜单
						window.location.href="$!basePath/system/unit";
					});
					setTimeout(function(){
						//返回上级菜单
						window.location.href="$!basePath/system/unit";
					}, 3000);
				}else{
					Toast.error(data.error);
					$form.find("button:submit").button("reset");
				}
	            
        	}
		});
		#if(!$!noUnit) 
			//初始化机构树
			initTreeView();
		#end
	});
			
    </script>
#loading_close</body>
</html>
